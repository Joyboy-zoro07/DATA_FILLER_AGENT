<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>CRM Data Filler — Polished Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#0f172a; --card:#0b1220; --muted:#94a3b8; 
      --accent:#2563eb; --success:#10b981; --warn:#f59e0b;
      --glass: rgba(255,255,255,0.03);
    }
    body{
      background: linear-gradient(180deg,#071033 0%, #031025 100%);
      color:#e6eef8; font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif; 
      margin:0; padding:28px;
    }
    .container{max-width:1100px;margin:0 auto;}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{width:56px;height:56px;border-radius:10px;
      background:linear-gradient(135deg,#2dd4bf,#3b82f6);
      display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{margin:0;font-size:20px}
    p.lead{color:var(--muted);margin:4px 0 0;font-size:13px}

    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:16px;
      box-shadow:0 6px 20px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    textarea{
      width:100%;height:180px;padding:12px;border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:var(--glass);color:inherit;resize:vertical
    }
    .controls{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    button.primary{
      background:var(--accent);color:white;border:0;padding:10px 14px;
      border-radius:8px;cursor:pointer
    }
    button.ghost{
      background:transparent;border:1px solid rgba(255,255,255,0.06);
      color:var(--muted);padding:8px 12px;border-radius:8px;cursor:pointer
    }
    button.success{
      background:var(--success);color:#062018;border:0;
      padding:10px 12px;border-radius:8px;cursor:pointer
    }

    .agent{margin-top:12px;padding:12px;border-radius:8px;
      background:linear-gradient(90deg, rgba(37,99,235,0.08), rgba(16,185,129,0.03));
      color:#eaf5ff;border:1px solid rgba(37,99,235,0.12)}
    .agent strong{display:block}

    .meta{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .badge{padding:6px 8px;border-radius:999px;font-size:12px;
      background:rgba(255,255,255,0.03);color:var(--muted);
      border:1px solid rgba(255,255,255,0.02)}
    .badge.green{background:rgba(16,185,129,0.12);color:#a7f3d0}
    .badge.yellow{background:rgba(245,158,11,0.08);color:#ffd9a8}

    .out-pre{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:14px;border-radius:10px;margin-top:12px;color:#dbeafe;
      max-height:420px;overflow:auto;border:1px solid rgba(255,255,255,0.03)}
    table{width:100%;border-collapse:collapse;color:#e6eef8}
    th,td{padding:8px 10px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:13px}
    th{color:var(--muted);font-weight:600}

    .right-panel{}
    .result-card{display:flex;flex-direction:column;gap:10px}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="logo">AI</div>
      <div>
        <h1>CRM Data Filler — Polished Demo</h1>
        <p class="lead">Paste a meeting note below. Agent will extract structured CRM data — download as JSON.</p>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <label class="small">Meeting summary</label>
        <textarea id="txt">
Had call with Sarah Johnson, Marketing Director at GrowthTech. They need marketing automation for a 50-person team. Budget: $30K annually. Evaluating HubSpot vs our solution. Next: Demo scheduled for Friday 10th June. Contact email: sarah.j@growthtech.com, phone +1-555-123-4567.
        </textarea>

        <div class="controls">
          <button class="primary" id="btnExtract" onclick="callExtract()">Extract</button>
          <button class="ghost" onclick="useSample(2)">Sample 2</button>
          <button class="ghost" onclick="useSample(3)">Sample 3</button>
          <button class="success" onclick="copyJSON()">Copy JSON</button>
          <button class="ghost" onclick="downloadJSON()">Download JSON</button>
        </div>

        <div id="agent" class="agent" style="display:none">
          <strong id="agent_msg"></strong>
          <div class="meta" id="badges"></div>
          <div class="small" id="summary"></div>
        </div>

        <div id="output_raw" class="out-pre" style="display:none">
          <pre id="out">No result yet</pre>
        </div>

        <div id="table_view" class="out-pre" style="display:none">
          <table>
            <thead><tr><th>Field</th><th>Value</th></tr></thead>
            <tbody id="result_body"></tbody>
          </table>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card right-panel">
        <div class="result-card">
          <h3 style="margin:0">Quick Extract Preview</h3>
          <p class="small">Important fields shown for quick copy/paste into CRM</p>
          <div id="quick_fields" style="display:grid;grid-template-columns:1fr 1fr;gap:8px"></div>

          <h4 style="margin-top:16px">CRM Payload (Preview)</h4>
          <pre id="payload_pre" class="out-pre">No payload yet</pre>
        </div>
      </div>
    </div>
  </div>

<script>
  function useSample(n){
    const samples={
      2:"Met John Doe, CTO of FinSolve. Problem: onboarding churn, wants analytics PoC. Budget INR 12,00,000. Contact: john@finsolve.in",
      3:"Call with Ritu Singh at FarmFresh — planning inventory optimization PoC. Follow up next week."
    };
    document.getElementById('txt').value=samples[n]||"";
  }

  async function callExtract(){
    const text=document.getElementById('txt').value.trim();
    if(!text){alert("Paste meeting notes first.");return;}

    const btn=document.getElementById('btnExtract');
    btn.disabled=true; btn.textContent="Working...";

    try{
      const res=await fetch('/extract',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({meeting_text:text})
      });
      const j=await res.json();
      renderResult(j);
    }catch(err){
      alert("Error: "+err);
    }finally{
      btn.disabled=false; btn.textContent="Extract";
    }
  }

  function renderResult(data){
    const ex=data.extracted||data;
    window.__LAST_EXTRACT=data;

    // Agent message
    document.getElementById('agent').style.display='block';
    document.getElementById('agent_msg').textContent=data.agent_message||"";

    // badges
    const badges=document.getElementById('badges');
    badges.innerHTML="";
    const confBadge=document.createElement('span');
    confBadge.className="badge green";
    confBadge.textContent="Confidence: "+Math.round((ex.confidence||0)*100)+"%";
    badges.appendChild(confBadge);

    if(ex.deal?.stage){
      const s=document.createElement('span');
      s.className="badge";
      s.textContent=ex.deal.stage;
      badges.appendChild(s);
    }

    // summary
    const s=[];
    if(ex.contact?.name) s.push(ex.contact.name);
    if(ex.contact?.title) s.push(ex.contact.title);
    if(ex.company?.name) s.push(ex.company.name);
    document.getElementById('summary').textContent=s.join(" — ");

    // Raw JSON
    document.getElementById('output_raw').style.display="block";
    document.getElementById('out').textContent=JSON.stringify(data,null,2);

    // Table
    const body=document.getElementById('result_body');
    body.innerHTML="";
    const addRow=(k,v)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<th>${k}</th><td>${v||''}</td>`;
      body.appendChild(tr);
    };
    addRow("Contact Name",ex.contact?.name);
    addRow("Title",ex.contact?.title);
    addRow("Email",ex.contact?.email);
    addRow("Phone",ex.contact?.phone);
    addRow("Company",ex.company?.name);
    addRow("Deal Name",ex.deal?.name);
    addRow("Deal Value",ex.deal?.currency+" "+ex.deal?.value_usd);
    addRow("Close Date",ex.deal?.close_date);

    document.getElementById("table_view").style.display="block";

    // Quick fields
    const q=document.getElementById('quick_fields');
    q.innerHTML="";
    const card=(lbl,val)=>`<div style="background:rgba(255,255,255,0.02);padding:10px;border-radius:8px">
      <div class="small">${lbl}</div><div style="font-weight:600;margin-top:6px">${val||'—'}</div></div>`;
    q.innerHTML+=card("Contact",ex.contact?.name);
    q.innerHTML+=card("Email",ex.contact?.email);
    q.innerHTML+=card("Company",ex.company?.name);
    q.innerHTML+=card("Deal",ex.deal?.name);

    // Payload preview
    const payload={
      properties:{
        firstname:(ex.contact?.name||'').split(" ")[0]||'',
        lastname:(ex.contact?.name||'').split(" ").slice(1).join(" "),
        email:ex.contact?.email||'',
        phone:ex.contact?.phone||'',
        company:ex.company?.name||'',
        dealname:ex.deal?.name||'',
        amount:ex.deal?.value_usd||'',
        closedate:ex.deal?.close_date||''
      }
    };
    document.getElementById('payload_pre').textContent=JSON.stringify(payload,null,2);
  }

  function copyJSON(){
    const txt=document.getElementById('out').textContent;
    navigator.clipboard.writeText(txt);
    alert("JSON copied!");
  }

  function downloadJSON(){
    const txt=document.getElementById('out').textContent;
    const blob=new Blob([txt],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url; a.download="crm_extracted.json"; a.click();
    URL.revokeObjectURL(url);
  }
</script>

</body>
</html>
